<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

  <title>ì½”ë¼ë¦¬</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <link crossorigin="anonymous"
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx"
        rel="stylesheet">
  <script crossorigin="anonymous"
          integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
          src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js">
  </script>

  <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>

  <!-- ë¡œê³  -->
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/128/1864/1864497.png"/>

  <link rel="stylesheet" type="text/css"  href="/css/searchedPage.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <style>

  </style>
</head>
<body>

<!-- ìƒë‹¨ ë©”ë‰´ (+ ë„¤ë¹„ê²Œì´ì…˜ ë©”ë‰´)-->
<div class="header">
  <div class="right">
    <a id="login" onclick="redirectToLoginPage()">
      <button>ë¡œê·¸ì¸</button>
    </a>
    <a id="logout" onclick="logout()">
      <button>ë¡œê·¸ì•„ì›ƒ</button>
    </a>
    <a id="keeplogin" onclick="refreshAccessToken()">
      <button>ë¡œê·¸ì¸ ì—°ì¥</button>
    </a>
  </div>
  <div class="middle">
    <!-- ê°€ìš´ë° ì½”ë¼ë¦¬ ê¸€ì”¨ ë° ë¡œê³   -->
    <img src="https://cdn-icons-png.flaticon.com/128/1864/1864497.png" style="width: 35px; height: 35px; cursor: pointer" onclick="gotoMain()"> <!-- ë¡œê³  ì´ë¯¸ì§€ ì¶”ê°€ -->
    <div style="text-align: center;
                    cursor:pointer;
                    font-size: 35px;" onclick="gotoMain()">
      ì½”ë¼ë¦¬
    </div>
  </div>
  <div class="left">
    <!-- ì•Œë¦¼, ìš°ì¸¡ ë©”ë‰´ ìŠ¬ë¼ì´ë“œ -->
    <div class="notification-icon">
      <div style="position: relative;">
        <i class="far fa-bell" style="color: #cfcfcf;"></i>
        <span id="notificationBadge" class="nobadge" style="display:none;"></span>
      </div>
    </div>

    <div style="text-align: center;" type="button" data-bs-toggle="offcanvas"
         data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions">
      <img src="https://cdn-icons-png.flaticon.com/128/8212/8212733.png"
           style="width: 40px; height: 40px;"> <!-- ë¡œê³  ì´ë¯¸ì§€ ì¶”ê°€ -->
    </div>

    <div class="offcanvas offcanvas-start w-25" data-bs-scroll="true" tabindex="-1"
         id="offcanvasWithBothOptions" aria-labelledby="offcanvasWithBothOptionsLabel">
      <div class="offcanvas-header" style="text-align: center; align-items:center;">
        <h5 class="offcanvas-title" id="offcanvasWithBothOptionsLabel" style="color:#000">
          <img src="https://cdn-icons-png.flaticon.com/128/1864/1864497.png"
               style="width: 40px; height: 40px;"> <!-- ë¡œê³  ì´ë¯¸ì§€ ì¶”ê°€ -->
          ì½”ë¼ë¦¬
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"
                aria-label="Close"></button>
      </div>

      <div class="list-group list-group-flush">
        <!-- ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ê³¼ í•˜ìœ„ ë©”ë‰´ -->
        <button class="list-group-item list-group-item-action" data-bs-toggle="collapse"
                data-bs-target="#categoryMenu">ê²Œì‹œíŒ ì¹´í…Œê³ ë¦¬
        </button>
        <div id="categoryMenu" class="collapse">
          <a href="/api/posts/categories/1"
             class="list-group-item list-group-item-action mini-list">í˜‘ì—… ì¸ì› ëª¨ì§‘</a>
          <a href="/api/posts/categories/2"
             class="list-group-item list-group-item-action mini-list">ìŠ¤í‹°ë””ì› ëª¨ì§‘</a>
          <a href="/api/posts/categories/3"
             class="list-group-item list-group-item-action mini-list">ë¬¸ì œì€í–‰</a>
          <a href="/api/posts/categories/4"
             class="list-group-item list-group-item-action mini-list">ììœ ê²Œì‹œíŒ</a>
        </div>

        <a href="/api/view/users" class="list-group-item list-group-item-action">ë§ˆì´í˜ì´ì§€</a>
        <a href="/api/boards" class="list-group-item list-group-item-action">í”„ë¡œì íŠ¸ í˜ì´ì§€</a>
        <a href="/api/chatRooms" class="list-group-item list-group-item-action">ì±„íŒ… í˜ì´ì§€</a> <!--ì±„íŒ… í˜ì´ì§€ í…ŒìŠ¤íŠ¸ ì¤‘-->
        <a href="/api/view/admins" class="list-group-item list-group-item-action" th:if="${admin}">ê´€ë¦¬ì í˜ì´ì§€</a> <!--ì„œë²„ì—ì„œ admin ì—¬ë¶€ true/falseë¡œ ê°€ì ¸ì˜¤ê¸°-->


      </div>

    </div>

  </div>

</div>

<!-- ë‚˜ë¨¸ì§€ ë‚´ìš© -->
<div class="notification-list" id="notificationList">
  <div class="notification-list-header">
    <!-- ì „ì²´ì½ìŒ ë²„íŠ¼ ì¶”ê°€ -->
    <button id="markAllReadButton" class="mark-all-read-button">ì „ì²´ ì½ìŒ</button>
    ì•Œë¦¼
  </div>
</div>


<!--ìƒë‹¨ë°” ì•„ë˜ ì œëª©ê³¼ ê²Œì‹œê¸€ ì˜ì—­-->
<div class="bottom">
  <div class="bottomone">
    <div class="bottomonewrapper">
      <!--ì¹´í…Œê³ ë¦¬ ì¶œë ¥-->
      <div class="text-center">
        <text th:text="${categoryName}">Category</text>
      </div>

      <!--ê²€ìƒ‰ ì°½-->
      <div id="search-bar">
        <input type="text" id="search-input" placeholder="ê²Œì‹œê¸€ ì œëª© ê²€ìƒ‰"
               style="height: 34px; padding:10px;" th:value="${searchedTitle}">
        <button style="
                background-color: #e6e6e6; color: #1a1313;
                border:none; margin-left: 10px;" class="btn btn-primary" th:onclick="'searchByTitle(\'' + ${category} + '\')'">ê²€ìƒ‰
        </button>
      </div>

      <!-- ê²Œì‹œê¸€ ìƒì„± ë²„íŠ¼ -->
      <div class="button-center">
        <button type="button" class="btn btn-primary" id="create-post-button"
                style="
                background-color: #e6e6e6; color: #1a1313;
                border:none;" data-bs-toggle="modal" data-bs-target="#exampleModal">ê²Œì‹œê¸€ ìƒì„±
        </button>
      </div>
    </div>
  </div>

  <div class="bottomtwo">
    <div class="list-group list-group-flush" style="width: 80%">

      <a class="list-group-item" aria-current="true" >
        <div class="d-flex w-75 justify-content-between">
          <h5 class="card-title mb-0">ì œëª©</h5>
          <p class="card-text mb-0">ë‚´ìš©</p>
        </div>
        <div class="d-flex w-25 justify-content-between">
          <div style="width: 40%; display: flex; justify-content: center; align-items: center;">
            <p class="mb-1">ë‹‰ë„¤ì„</p>
          </div>
          <div style="width: 30%; text-align: center; display: flex; justify-content: center; align-items: center;">
            <small>ì¡°íšŒìˆ˜</small>
          </div>
          <div style="width: 30%; text-align: center; display: flex; justify-content: center; align-items: center;">
            <small>ì‘ì„±ë‚ ì§œ</small>
          </div>
        </div>
      </a>

      <a th:onclick="'gotoPost(\'' + ${post.id} + '\')'" class="list-group-item list-group-item-action" aria-current="true" th:each="post, postIndex : ${posts}">
        <div class="d-flex w-75 justify-content-between">
          <h5 class="card-title mb-0">
            <span th:text="|${(post.title.length() > 15 ? #strings.substring(post.title, 0, 15) + '...' : post.title)}|"></span>
            <span th:if="${post.getPostCommentList().size() > 0}" th:text="${' (' + post.getPostCommentList().size() + ')'}"> (ëŒ“ê¸€ê°¯ìˆ˜)</span>
            <span th:if="${post.files != null}" style="font-size: smaller;">ğŸ–¼ï¸</span>
          </h5>
          <p class="card-text mb-0" th:text="|${post.content.length() > 50 ? #strings.substring(post.content, 0, 50) + '...' : post.content}|">Some quick example text to build on the card title ...</p>
        </div>
        <div class="d-flex w-25 justify-content-between">
          <div style="width: 40%; display: flex; justify-content: center; align-items: center;">
            <p class="mb-1" th:text="|${post.nickname}|">ë‹‰ë„¤ì„</p>
          </div>
          <div style="width: 30%; text-align: center; display: flex; justify-content: center; align-items: center;">
            <small th:text="|ì¡°íšŒìˆ˜ : ${post.view_cnt}|">ì¡°íšŒìˆ˜: 00íšŒ</small>
          </div>
          <div style="width: 30%; text-align: center; display: flex; justify-content: center; align-items: center;">
            <small th:text="${#temporals.format(post.createdAt, 'MMì›” ddì¼ HH:mm:ss')}">11/11 11:11:11</small>
          </div>
        </div>
      </a>
    </div>
  </div>

  <!--í˜ì´ì§• ì²˜ë¦¬ ì½”ë“œ -->
  <div class="bottomthree">
    <!-- í˜ì´ì§•ì²˜ë¦¬ ì‹œì‘ -->
    <div th:if="${!posts.isEmpty()}">
      <ul class="pagination justify-content-center custom-pagination">
        <li class="page-item" th:classappend="${!posts.hasPrevious()} ? 'disabled'">
          <a class="page-link"
             th:href="@{|?title=${searchedTitle}&page=${posts.getPageable().getPageNumber() - 1}|}">
            <span>ì´ì „</span>
          </a>
        </li>
        <li th:each="page: ${#numbers.sequence(0, posts.getTotalPages() -1)}"
            th:if="${page >= page - 5 and page <= page + 5}"
            class="page-item">
          <a th:text="${page + 1}" class="page-link"
             th:href="@{|?title=${searchedTitle}&page=${page + 1}|}"
             th:style="${page == posts.getPageable().getPageNumber()} ? 'background-color: #f5f5fa;' : ''">1</a>
        </li>


        <li class="page-item" th:classappend="${!posts.hasNext()} ? 'disabled'">
          <a class="page-link" th:href="@{|/api/posts/categories/${category}/titles?title=${searchedTitle}&page=${posts.getPageable().getPageNumber() + 2}|}">
            <span>ë‹¤ìŒ</span>
          </a>
        </li>
      </ul>
    </div>
    <!-- í˜ì´ì§•ì²˜ë¦¬ ë -->
  </div>

</div>

<script>
  const Toast = Swal.mixin({
    toast: true,
    position: 'center-center',
    showConfirmButton: false,
    timer: 1000,
    timerProgressBar: true,
    didOpen: (toast) => {
      toast.addEventListener('mouseenter', Swal.stopTimer)
      toast.addEventListener('mouseleave', Swal.resumeTimer)
    }
  })

  function gotoMain() {
    window.location.href = "/main";
  }

  // ê²Œì‹œê¸€ ìƒì„± ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
  $("#create-post-button").click(function () {
    // ê²Œì‹œê¸€ ìƒì„± í˜ì´ì§€ë¡œ ì´ë™
    window.location.replace("/api/post-page");
  });

  // ì œëª©ìœ¼ë¡œ ê²Œì‹œê¸€ ê²€ìƒ‰
  function searchByTitle(category) {
    const searchInput = document.getElementById("search-input").value;

    // ê²€ìƒ‰ ê²°ê³¼ í˜ì´ì§€ë¡œ ì´ë™
    window.location.replace("/api/posts/categories/" + category + "/titles?title=" + searchInput);
  }


  // header js ì½”ë“œ ì¶”ê°€
  $(document).ready(function () {
    pageSetting();

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ ì•Œë¦¼ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜´
    const token = Cookies.get('Authorization');
    if(token){ // í† í° ìˆì„ ê²½ìš°
      const notificationIcon = document.querySelector('.notification-icon');
      const notificationBadge = document.getElementById('notificationBadge');
      const notificationList = document.getElementById('notificationList');
      let isNotificationListOpen = false;
      let notificationsList = []; // ì•Œë¦¼ ë°ì´í„°ë¥¼ ì €ì¥í•  ë¦¬ìŠ¤íŠ¸
      let userId = null; // ì‚¬ìš©ì ì•„ì´ë”” ë³€ìˆ˜ ì¶”ê°€

      // ì•Œë¦¼ ë°ì´í„°ë¥¼ ì„œë²„ì—ì„œ ë¶ˆëŸ¬ì™€ì„œ ëª©ë¡ì— ì¶”ê°€í•˜ëŠ” í•¨ìˆ˜
      const fetchNotifications = async (userId) => {
        try {
          const response = await fetch(`/api/notifications/list/${userId}`);
          if (response.ok) {
            const notifications = await response.json();
            notificationsList = notifications;
            updateNotificationList();
            updateNotificationIcon();
          } else {
            console.error('Error fetching notifications:', response.status);
          }
        } catch (error) {
          console.error('Error fetching notifications:', error);
        }
      };

      // ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” í•¨ìˆ˜
      const fetchUserInfo = async () => {
        try {
          const response = await fetch('/api/get-user-info');
          if (response.ok) {
            const userData = await response.json();
            if (userData && userData.id) {
              userId = userData.id;
              loadNotificationsFromServer(userId);
            }
          } else {
            console.error('Error fetching user info:', response.status);
          }
        } catch (error) {
          console.error('Error fetching user info:', error);
        }
      };



      // ì•Œë¦¼ ëª©ë¡ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      const updateNotificationList = () => {
        notificationList.innerHTML = ''; // ëª©ë¡ ì´ˆê¸°í™”
        notificationsList.forEach(notification => {
          addNotificationToList(notification);
        });
        const listHeader = document.createElement('div');
        listHeader.className = 'notification-list-header';

        // Create the "ì „ì²´ ì½ìŒ" button
        const markAllReadButton = `<button id="markAllReadButton" class="mark-all-read-button">ì „ì²´ ì½ìŒ</button>`;
        listHeader.innerHTML = markAllReadButton; // innerHTMLë¡œ ë²„íŠ¼ ì¶”ê°€
        listHeader.innerHTML += 'ì•Œë¦¼';

        notificationList.insertBefore(listHeader, notificationList.firstChild);

        // "ì „ì²´ ì½ìŒ" ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²°
        const button = document.getElementById('markAllReadButton');
        button.addEventListener('click', function () {
          markAllNotificationsAsRead();
        });

      };

      // í˜„ì¬ ì‹œê°„ê³¼ ì£¼ì–´ì§„ ì‹œê°„ ì‚¬ì´ì˜ ê²½ê³¼ ì‹œê°„ì„ ê³„ì‚°í•˜ì—¬ ë¬¸ìì—´ë¡œ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜
      const formatTimeAgo = (notificationTime) => {
        const currentTime = new Date();
        const timeDifference = currentTime - new Date(notificationTime);

        if (timeDifference < 60000) { // 1ë¶„ ë¯¸ë§Œ
          return "ë°©ê¸ˆ ì „";
        } else if (timeDifference < 3600000) { // 1ì‹œê°„ ë¯¸ë§Œ
          const minutes = Math.floor(timeDifference / 60000);
          return `${minutes}ë¶„ ì „`;
        } else if (timeDifference < 86400000) { // 24ì‹œê°„ ë¯¸ë§Œ
          const hours = Math.floor(timeDifference / 3600000);
          return `${hours}ì‹œê°„ ì „`;
        } else {
          const days = Math.floor(timeDifference / 86400000);
          if(isNaN(days)){
            return "ë°©ê¸ˆ ì „";
          } else {
            return `${days}ì¼ ì „`;
          }
        }
      };

      // ì•Œë¦¼ ì•„ì´í…œ ì¶”ê°€ í•¨ìˆ˜
      const addNotificationToList = (notification) => {
        const listItem = document.createElement('div');
        listItem.className = notification.read ? 'notification-list-item read' : 'notification-list-item unread';
        const timeAgo = formatTimeAgo(notification.createdAt);
        listItem.innerHTML = `${notification.content}<br><span class="notification-time">${timeAgo}</span>`;
        listItem.onclick = () => {
          handleNotificationItemClick(notification, listItem);
        };
        notificationList.insertBefore(listItem, notificationList.firstChild);
      };


      // ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ í•¨ìˆ˜
      const markNotificationAsRead = (notification, listItem) => {
        if (!notification.read) {
          notification.read = true;
          listItem.classList.remove('unread');
          listItem.classList.add('read');
          updateNotificationIcon();

          // AJAX ìš”ì²­ìœ¼ë¡œ ì„œë²„ì— ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ ìš”ì²­ ë³´ë‚´ê¸°
          $.post(`/api/mark-notification-as-read/${notification.id}`)
        }
      };

      // ì•Œë¦¼ ì•„ì´í…œ í´ë¦­ ì²˜ë¦¬ í•¨ìˆ˜
      const handleNotificationItemClick = (notification, listItem) => {
        markNotificationAsRead(notification, listItem);
        window.location.href = notification.url;
      };

      // ì•Œë¦¼ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      const updateNotificationIcon = () => {
        const unreadCount = notificationsList.filter(notification => !notification.read).length;
        if (unreadCount > 0) {
          notificationIcon.classList.add('new-notification');
          notificationBadge.style.display = "inline";
          notificationBadge.innerText = unreadCount.toString();
        } else {
          notificationIcon.classList.remove('new-notification');
          notificationBadge.style.display = "none";
          // notificationBadge.innerText = '';
        }
      };

      // ì¢…ëª¨ì–‘ ì•„ì´ì½˜ í´ë¦­ ì‹œ ì•Œë¦¼ ëª©ë¡ í‘œì‹œ/ìˆ¨ê¸°ê¸°
      notificationIcon.addEventListener('click', () => {
        updateNotificationList();
        if (!isNotificationListOpen) {
          notificationList.style.display = 'block';
          isNotificationListOpen = true;
        } else {
          notificationList.style.display = 'none';
          isNotificationListOpen = false;
        }
      });

      // í˜ì´ì§€ ë¡œë“œ ì‹œ ì•Œë¦¼ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ í‘œì‹œ
      const loadNotificationsFromServer = (userId) => {
        fetchNotifications(userId);
      };

      fetchUserInfo().then(() => {
        const sse = new EventSource(`/api/notifications/${userId}`);
        sse.onmessage = (event) => {
          const notification = JSON.parse(event.data);
          notificationsList.push(notification);
          addNotificationToList(notification);
          updateNotificationIcon();
        };
      });

      // ì•Œë¦¼ ì „ì²´ ì½ìŒ ì²˜ë¦¬ í•¨ìˆ˜
      function markAllNotificationsAsRead() {
        $.post(`/api/mark-all-notifications-as-read/${userId}`)
                .done(function(response) {
                  Toast.fire({
                    icon: 'success',
                    title: "ì „ì²´ ì½ìŒ ì²˜ë¦¬ ë˜ì—ˆìŠµë‹ˆë‹¤!",
                  }).then(function () {
                    window.location.reload();
                  })
                })
                .fail(function(response) {
                  Toast.fire({
                    icon: 'error',
                    title: "ì „ì²´ ì½ìŒ ì²˜ë¦¬ ì‹¤íŒ¨!",
                  })
                });
      }
    } // ifë¬¸ ì¢…ë£Œ

    document.addEventListener('click', function(event) {
      const notificationList = document.getElementById('notificationList');
      const notificationIcon = document.querySelector('.notification-icon');
      const isNotificationListOpen = notificationList.style.display === 'block';

      if (isNotificationListOpen && !notificationList.contains(event.target) && !notificationIcon.contains(event.target)) {
        notificationList.style.display = 'none';
      }
    });

  });

  function gotoPost(postId) {
    const token = Cookies.get('Authorization');

    if(token){ // í† í° ìˆì„ ê²½ìš°
      window.location.href = `/api/posts/${postId}`; // í´ë¦­ëœ ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œì— ë§ëŠ” ë§í¬ë¡œ ì´ë™
    } else {
      outOfLoginPage();
    }
  }

  function outOfLoginPage(){
    Swal.fire({
      title: 'ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.',
      text: 'ë¡œê·¸ì¸/íšŒì›ê°€ì… í•˜ëŸ¬ê°€ê¸°',
      icon: 'warning',

      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#3085d6',
      confirmButtonText: 'í™•ì¸',
      cancelButtonText: 'ì·¨ì†Œ',

      reverseButtons: false, // ë²„íŠ¼ ìˆœì„œ ê±°ê¾¸ë¡œ
    }).then(result => {
      if (result.isConfirmed) { // ë§Œì•½ ëª¨ë‹¬ì°½ì—ì„œ confirm ë²„íŠ¼ì„ ëˆŒë €ë‹¤ë©´
        redirectToLoginPage();
      }
    });
    Toast.fire({
      icon: 'error',
      title: "ë¡œê·¸ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤.",
    })
  }

  $(document).ready(function () {
    pageSetting();
  });

  function removeToken() { // í† í° ì‚­ì œ
    Cookies.remove('Authorization', {path: '/'});
  }

  /* ì„œë²„ í†µì‹  ë©”ì„œë“œ */
  function refreshAccessToken() { // ì—‘ì„¸ìŠ¤ í† í° ê°±ì‹ 
    $.ajax({
      type: "GET",
      url: `/api/auth/refresh/access-token`,
      contentType: "application/json",
      success: function (data) {
        // console.log(data);
        Toast.fire({
          icon: 'success',
          title: "ë¡œê·¸ì¸ ì—°ì¥ ì„±ê³µ",
        })
      },
      error: function (data) {
        // console.log(data);
        Toast.fire({
          icon: 'error',
          title: "ë¡œê·¸ì¸ ì—°ì¥ ì‹¤íŒ¨. ì¬ë¡œê·¸ì¸ ë¶€íƒë“œë¦½ë‹ˆë‹¤.",
        })
        redirectToLoginPage();
      }
    });
  }

  /* í˜ì´ì§€ ì²« ë¡œë“œ ë©”ì„œë“œ */
  function pageSetting() {  // main page ì„¸íŒ…
    const token = Cookies.get('Authorization');

    // console.log(token);
    // console.log(rtoken);

    const loginBtn = document.getElementById('login');
    const logoutBtn = document.getElementById('logout');
    const keeploginBtn = document.getElementById('keeplogin');

    if (!token) {
      loginBtn.style.display = "inline-block";
      logoutBtn.style.display = "none";
      keeploginBtn.style.display = "none";
    } else {
      loginBtn.style.display = "none";
    }

  }

  function logout() { // ë¡œê·¸ì•„ì›ƒ
    $.ajax({
      type: "DELETE",
      url: `/api/auth/logout`,
      contentType: "application/json",
      success: function (data) {
        removeToken();
        Toast.fire({
          icon: 'success',
          title: "ë¡œê·¸ì•„ì›ƒ ì„±ê³µ",
        }).then(function () {
          window.location.href = "/main";
        })

      },
      error: function () {
        Toast.fire({
          icon: 'error',
          title: "ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨",
        }).then(function () {
          window.location.reload();
        })
      }
    });
  }

  function redirectToLoginPage() {
    window.location.href = "/api/auth/login-page";
  }

</script>
</body>
</html>